<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{header :: html-head}"></head>

<body class="d-flex flex-column min-vh-100 bg-light">
<div th:replace="~{header :: main-header}"></div>

<main class="container my-5">
    <h1 class="mb-4 text-center text-primary fw-bold">Thống kê Doanh thu</h1>

    <div class="card shadow-sm text-center mb-5 mx-auto" style="max-width: 800px;">
        <div class="card-header">
            <h5>Doanh thu tháng 10</h5>
        </div>
        <div class="card-body">
            <h2 class="text-success fw-bold">45.200.000₫</h2>
            <canvas id="salesChart"></canvas>
        </div>
    </div>

    <div class="card shadow-sm text-center mx-auto" style="max-width: 800px;">
        <div class="card-header">
            <h5>Doanh thu theo ngày (với Plugins)</h5>
        </div>
        <div class="card-body">
            <canvas id="myChart"></canvas>
            <button id="resetZoom" class="btn btn-primary mt-3">Reset Zoom</button>
        </div>
    </div>

    <script th:inline="javascript">
        // --- Biểu đồ 1: Doanh thu hàng tuần ---
        const salesCtx = document.getElementById('salesChart');
        new Chart(salesCtx, {
            type: 'bar',
            data: {
                labels: ['Tuần 1', 'Tuần 2', 'Tuần 3', 'Tuần 4'],
                datasets: [{
                    label: 'Doanh thu (VNĐ)',
                    data: [9000000, 11000000, 13000000, 12000000],
                    backgroundColor: '#0d6efd',
                    borderRadius: 5
                }]
            }
        });

        // --- Biểu đồ 2: Doanh thu hàng ngày với Plugins ---
        const dailyCtx = document.getElementById('myChart').getContext('2d');
        const gradient = dailyCtx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, 'rgba(75,192,192,0.6)');
        gradient.addColorStop(1, 'rgba(75,192,192,0.1)');

        // Đăng ký các plugin cần thiết
        Chart.register(ChartDataLabels, window['chartjs-plugin-zoom'], window['chartjs-plugin-annotation']);

        const dailyChart = new Chart(dailyCtx, {
            type: 'line',
            data: {
                labels: [
                    new Date(2025, 0, 1), new Date(2025, 0, 2), new Date(2025, 0, 3),
                    new Date(2025, 0, 4), new Date(2025, 0, 5)
                ],
                datasets: [{
                    label: 'Doanh thu (triệu VND)',
                    data: [100, 120, 90, 150, 180],
                    borderColor: 'rgba(75,192,192,1)',
                    backgroundColor: gradient,
                    fill: true,
                    tension: 0.3,
                    pointRadius: 5
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: { type: 'time', time: { unit: 'day' }, title: { display: true, text: 'Ngày' } },
                    y: { beginAtZero: true, title: { display: true, text: 'Doanh thu (triệu)' } }
                },
                plugins: {
                    datalabels: {
                        align: 'top', color: '#000', font: { weight: 'bold' },
                        formatter: (value) => value + 'tr'
                    },
                    zoom: {
                        pan: { enabled: true, mode: 'x' },
                        zoom: { wheel: { enabled: true }, pinch: { enabled: true }, mode: 'x' }
                    },
                    annotation: {
                        annotations: {
                            line1: {
                                type: 'line', yMin: 130, yMax: 130, borderColor: 'red', borderWidth: 2,
                                label: { enabled: true, content: 'Mốc 130tr', position: 'center' }
                            },
                            box1: {
                                type: 'box', xMin: new Date(2025, 0, 2), xMax: new Date(2025, 0, 3),
                                yMin: 0, yMax: 200, backgroundColor: 'rgba(255, 99, 132, 0.1)'
                            }
                        }
                    }
                }
            }
        });

        // Nút Reset Zoom
        document.getElementById('resetZoom').addEventListener('click', () => {
            dailyChart.resetZoom();
        });
    </script>
</main>
<div th:replace="~{footer :: main-footer}"></div>
</body>
</html>