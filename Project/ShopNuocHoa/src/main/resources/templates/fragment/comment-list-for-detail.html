<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>

<div th:fragment="comment-list">
    <hr>
    <h4 class="mb-3">Các bình luận đã có:</h4>

    <div th:if="${commentPage == null or commentPage.empty}">
        <p class="text-muted">Chưa có bình luận nào cho sản phẩm này.</p>
    </div>

    <div th:if="${commentPage != null and !commentPage.empty}">
        <div th:each="comment, iterStat : ${commentPage.content}">
            <div class="d-flex mb-3">
                <div class="flex-shrink-0">
                    <i class="bi bi-person-circle" style="font-size: 2.5rem; color: #6c757d;"></i>
                </div>
                <div class="ms-3 w-100">

                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class_="fw-bold mb-1" th:text="${comment.customer != null ? comment.customer.name : 'Người dùng ẩn danh'}"></h6>
                        <small class="text-muted" th:if="${comment.createdAt != null}" th:text="${#temporals.format(comment.createdAt, 'dd-MM-yyyy HH:mm')}"></small>
                    </div>
                    <div class="mb-1" th:if="${comment.rating > 0}">
                        <span th:each="i : ${#numbers.sequence(1, 5)}" th:classappend="${i <= comment.rating} ? 'text-warning' : 'text-muted'" class="fs-5" style="letter-spacing: -3px;">★</span>
                    </div>

                    <p th:id="'comment-text-' + ${comment.id}" th:text="${comment.text}">Nội dung bình luận ở đây.</p>

                    <div class="comment-actions mt-2"
                         th:id="'comment-actions-' + ${comment.id}"
                         th:if="${loggedInCustomerId != null and comment.customer != null and loggedInCustomerId == comment.customer.id}">

                        <button type="button" class="btn btn-sm btn-outline-secondary me-2 btn-edit-comment"
                                th:data-comment-id="${comment.id}">Sửa</button>

                        <form th:action="@{/api/comments/delete/{id}(id=${comment.id})}" method="post" class="d-inline"
                              onsubmit="return confirm('Bạn có chắc chắn muốn xóa bình luận này không?');">
                            <button type="submit" class="btn btn-sm btn-outline-danger">Xóa</button>
                        </form>
                    </div>

                    <div th:id="'comment-edit-form-' + ${comment.id}" class="mt-3" style="display: none;">
                        <form class="form-edit-comment">
                            <input type="hidden" name="commentId" th:value="${comment.id}">
                            <textarea name="text" class="form-control" rows="3" th:text="${comment.text}"></textarea>
                            <div class="mt-2">
                                <button type="submit" class="btn btn-sm btn-primary btn-save-comment">Lưu</button>
                                <button type="button" class="btn btn-sm btn-light btn-cancel-edit"
                                        th:data-comment-id="${comment.id}">Hủy</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <hr th:if="${!iterStat.last}">
        </div>
    </div>

<!--    <nav aria-label="Comment page navigation" th:if="${commentPage.totalPages > 1}">-->
<!--        <ul class="pagination pagination-sm justify-content-center">-->
<!--            <li class="page-item" th:classappend="${commentPage.first ? 'disabled' : ''}">-->
<!--                <a class="page-link" th:href="@{/api/products/detail/{id}(id=${productId}, page=${commentPage.number - 1})}">Trước</a>-->
<!--            </li>-->
<!--            <li class="page-item" th:each="pageNumber : ${#numbers.sequence(0, commentPage.totalPages - 1)}" th:classappend="${pageNumber == commentPage.number ? 'active' : ''}">-->
<!--                <a class="page-link" th:href="@{/api/products/detail/{id}(id=${productId}, page=${pageNumber})}" th:text="${pageNumber + 1}"></a>-->
<!--            </li>-->
<!--            <li class="page-item" th:classappend="${commentPage.last ? 'disabled' : ''}">-->
<!--                <a class="page-link" th:href="@{/api/products/detail/{id}(id=${productId}, page=${commentPage.number + 1})}">Sau</a>-->
<!--            </li>-->
<!--        </ul>-->
<!--    </nav>-->
</div>

</body>
</html>